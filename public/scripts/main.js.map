{"mappings":"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","sources":["src/scripts/main.js"],"sourcesContent":["'use strict';\n\nconst apiUrl = process.env.API_URL;\n\nconst items = document.querySelector('.items');\nconst addItemForm = document.querySelector('[data-form=\"add-item\"]');\nconst addItem = document.querySelector('[name=\"add-item\"]');\nconst addInputError = document.querySelector('[data-input-error=\"add-item\"]');\n\nconst modal = document.querySelector('.modal');\nconst modalContent = modal.querySelector('.modal-content');\nconst modalMessage = modalContent.querySelector('.modal-message');\n\nconst deleteAllReminder = '<p>Reminder.</p>' +\n    '<p class=\"error-message\">This will delete all items.</p>' +\n    '<div class=\"margin-top\">' +\n    '<button class=\"btn cancel-btn\" data-modal-btn=\"cancel\">No, cancel</button>' +\n    '<button class=\"btn delete-btn\" data-modal-btn=\"delete_all\">Yes, delete</button>' +\n    '</div>';\n\n\n/**********************************************************\n *  Transition handling\n *********************************************************/\n\n// Remove slide in transition associated styles\n// to have the default item functionality\nfunction removeSlideInAttributes(item) {\n    item.classList.remove('enter');\n    item.removeAttribute('style');\n}\n\n// Slide in transition\nfunction slideInAddedItem(addedItem) {\n    addedItem.style.maxHeight = addedItem.scrollHeight + 'px';\n    addedItem.style.opacity = 1;\n}\n\nfunction slideTransition(element) {\n\n    if (element.style.maxHeight) {\n        element.style.maxHeight = null;\n    } else {\n        element.style.maxHeight = element.scrollHeight + 'px';\n    }\n}\n\n/**********************************************************\n *  DOM manipulation\n *********************************************************/\n\n// Receives a pug rendered HTML string of the item element.\nfunction addItemToItems(itemElement) {\n    items.insertAdjacentHTML('afterbegin', itemElement);\n\n    slideInAddedItem(items.firstElementChild);\n}\n\n\n// The delete class sets max-height to 0 which starts a transition.\n// The element will be removed from the DOM on event transitionend.\nfunction deleteElement(element) {\n    element.classList.add('delete');\n}\n\nfunction deleteAllItems() {\n\n    while (items.firstChild) {\n        items.removeChild(items.firstChild);\n    }\n}\n\n/**********************************************************\n *  Item editing\n *********************************************************/\n\nfunction disableItemEdit(itemName, cancel = false) {\n\n    // Disable input \n    itemName.disabled = true;\n\n    // Reset value\n    if (cancel)\n        itemName.value = itemName.dataset.value;\n}\n\nfunction enableItemEdit(itemName) {\n\n    // Enable input\n    itemName.disabled = false;\n\n    // Give it focus\n    itemName.focus();\n\n    // Position cursor at the end of the input text\n    const cursorPosition = itemName.value.length;\n    itemName.setSelectionRange(cursorPosition, cursorPosition);\n}\n\nfunction toggleItemEdit(itemElement, cancel) {\n\n    slideTransition(itemElement.querySelector('.slide-transition'));\n    const itemName = itemElement.querySelector('.item-name');\n\n    if (itemName.disabled) {\n        enableItemEdit(itemName);\n    } else {\n        disableItemEdit(itemName, cancel);\n    }\n}\n\n\n/**********************************************************\n *  Error handling\n *********************************************************/\n\nfunction displayInputError(message) {\n\n    addInputError.textContent = message;\n    addItem.classList.add('error-border');\n    addItem.focus();\n}\n\nfunction hideInputError() {\n\n    addInputError.textContent = '';\n    addItem.classList.remove('error-border');\n}\n\nfunction errorMessage(message, tryAgain = true) {\n\n    return '<p>Sorry.</p>' +\n        '<p class=\"error-message\">' + message + '.</p>' +\n        (tryAgain ? '<p>Please try again later.</p>' : '');\n}\n\n\n/**********************************************************\n *  Modal display & hide\n *********************************************************/\n\nfunction displayModal(message) {\n\n    modalMessage.innerHTML = message;\n\n    modal.style.display = 'flex';\n}\n\nfunction hideModal() {\n\n    modal.style.display = 'none';\n}\n\n\n/**********************************************************\n *  Request handlers\n *********************************************************/\n\nfunction addItemHandler(event) {\n    event.preventDefault();\n\n    const name = addItem.value.trim();\n    // Make sure input is not empty\n    if (name.length < 1) {\n        displayInputError('Item cannot be empty.');\n        return;\n    }\n\n    fetch(apiUrl + '/', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ name, ui: true }),\n    })\n        .then(function (res) {\n            if (!res.ok) {\n                throw new Error('API response was not ok.');\n            }\n\n            return res.text();\n        })\n        .then(function (res) {\n            // Reset input field and add the new item\n            addItem.value = '';\n\n            addItemToItems(res);\n        })\n        .catch(function () {\n            displayModal(errorMessage('Could not add ' + name))\n        });\n}\n\n\nfunction deleteAllItemsHandler() {\n\n    hideModal();\n\n    // Skip api request if items already empty\n    if (!items.firstElementChild) return;\n\n    fetch(apiUrl + '/', {\n        method: 'DELETE',\n    })\n        .then(deleteAllItems)\n        .catch(function () {\n            displayModal(errorMessage('Could not delete all items'));\n        });\n}\n\n\nfunction deleteItemHandler(itemElement) {\n    itemElement.blur();\n\n    const itemId = itemElement.dataset.itemId;\n\n    fetch(apiUrl + '/' + itemId, {\n        method: 'DELETE',\n    })\n        .then(function (res) {\n            if (!res.ok) {\n                throw new Error('API response was not ok.');\n            }\n\n            deleteElement(itemElement);\n        })\n        .catch(function () {\n            const itemName = itemElement.querySelector('.item-name');\n            const name = itemName.value || 'item';\n\n            displayModal(errorMessage('Could not delete ' + name));\n        });\n}\n\n\nfunction updateItemHandler(itemElement) {\n\n    const id = itemElement.dataset.itemId;\n    const itemName = itemElement.querySelector('.item-name');\n    const name = itemName.value.trim();\n\n    // Skip api request if value is empty or unchanged\n    if (name.length < 1 || name === itemName.dataset.value) {\n        // Toggle edit buttons and reset value\n        toggleItemEdit(itemElement, true);\n        return;\n    }\n\n    fetch(apiUrl + '/' + id, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ name, ui: true }),\n    })\n        .then(function (res) {\n            if (!res.ok) {\n                throw new Error('API response was not ok.');\n            }\n\n            return res.json();\n        })\n        .then(function (res) {\n\n            if (res.error === 404) {\n                // Item not found, remove it from ui\n                displayModal(errorMessage('The item has been deleted by someone else', false));\n                deleteElement(itemElement);\n                return;\n            }\n\n            // Update values\n            itemName.dataset.value = res.name;\n            itemName.value = res.name;\n\n            // Toggle edit buttons\n            toggleItemEdit(itemElement);\n        })\n        .catch(function () {\n            displayModal(errorMessage('Could not update ' + name));\n        });\n}\n\n\n/**********************************************************\n *  Event listeners\n *********************************************************/\n\n/**\n *  Submit event listener to add item form\n */\nif (addItemForm) {\n    addItemForm.addEventListener('submit', addItemHandler);\n}\n\n\n/**\n *  Input event listener to add item \n */\nif (addItem) {\n    addItem.addEventListener('input', function (event) {\n\n        // If error is shown, hide it when provided valid input\n        if (this.matches('.error-border') && /\\S/.test(event.data) &&\n            event.inputType !== 'deleteContentBackward') {\n            hideInputError();\n        }\n\n    });\n}\n\n\n/**\n *  Transition end listener\n */\ndocument.addEventListener('transitionend', function (event) {\n\n    // Remove item from the DOM\n    if (event.target.matches('.item.delete')) {\n        items.removeChild(event.target);\n        return;\n    }\n\n    // Remove slide in transition associated styles\n    if (event.target.matches('.item.enter')) {\n        removeSlideInAttributes(event.target);\n        return;\n    }\n\n});\n\n\n/**\n * Click event listener \n * \n * Firefox listens to all clicks, not only primary 'left' button clicks.\n * Use document.documentElement or add: if (event.button !== 0) return;\n * https://gomakethings.com/you-should-always-attach-your-vanilla-js-click-events-to-the-window/ \n */\ndocument.documentElement.addEventListener('click', function (event) {\n\n    if (event.target === modal || event.target.closest('.close-modal') ||\n        event.target.matches('[data-modal-btn=\"cancel\"]')) {\n\n        event.preventDefault();\n\n        hideModal();\n        return;\n    }\n\n    if (event.target.matches('[data-modal-btn=\"delete_all\"]')) {\n\n        event.preventDefault();\n\n        deleteAllItemsHandler();\n        return;\n    }\n\n    const item = event.target.closest('.item');\n\n    if (event.target.closest('[data-item-btn=\"delete\"]')) {\n\n        event.preventDefault();\n\n        deleteItemHandler(item);\n        return;\n    }\n\n    if (event.target.closest('[data-item-btn=\"edit\"]')) {\n\n        event.preventDefault();\n\n        toggleItemEdit(item, true);\n        return;\n    }\n\n    if (event.target.closest('[data-item-btn=\"update\"]')) {\n\n        event.preventDefault();\n\n        updateItemHandler(item);\n        return;\n    }\n\n    if (event.target.closest('[data-btn=\"delete all\"]')) {\n\n        event.preventDefault();\n\n        displayModal(deleteAllReminder);\n        return;\n    }\n\n}, false);\n"],"names":["$e5ab1dab6b27115b$var$items","document","querySelector","$e5ab1dab6b27115b$var$addItemForm","$e5ab1dab6b27115b$var$addItem","$e5ab1dab6b27115b$var$addInputError","$e5ab1dab6b27115b$var$modal","$e5ab1dab6b27115b$var$modalMessage","$e5ab1dab6b27115b$var$deleteElement","element","classList","add","$e5ab1dab6b27115b$var$deleteAllItems","firstChild","removeChild","$e5ab1dab6b27115b$var$toggleItemEdit","itemElement","cancel","style","maxHeight","scrollHeight","itemName","disabled","focus","cursorPosition","value","length","setSelectionRange","$e5ab1dab6b27115b$var$enableItemEdit","param","dataset","$e5ab1dab6b27115b$var$disableItemEdit","$e5ab1dab6b27115b$var$errorMessage","message","$e5ab1dab6b27115b$var$displayModal","innerHTML","display","$e5ab1dab6b27115b$var$hideModal","addEventListener","event","preventDefault","name","trim","textContent","fetch","$e5ab1dab6b27115b$var$apiUrl","method","headers","body","JSON","stringify","ui","then","res","ok","Error","text","addedItem","insertAdjacentHTML","firstElementChild","opacity","catch","this","matches","test","data","inputType","remove","item","target","removeAttribute","documentElement","closest","id","blur","itemId","$e5ab1dab6b27115b$var$deleteItemHandler","json","error"],"version":3,"file":"main.js.map"}